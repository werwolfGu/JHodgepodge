# MySQL日志文件

> MySQL包含3个日志文件 `redolog` `undolog` `binlog`

## Binlog

- **用途**
  - 数据恢复：用于数据库崩溃后的数据恢复，通过重放二进制文件，可以恢复到最近一次备份后的状态；
  - 复制：用于主从复制，从服务器通过读取主服务器的二进制日志重放其中的事件，实现数据同步；
- **特性**
  - 记录所有对数据库执行修改操作（insert update delete）；
  - 只记录提交的事务；

## Redo log （重做日志）

- **用途**
  - 用于数据库崩溃时，恢复未完成的事务，确保数据库的持久性；
- **特性**
  - 记录所有事务的修改操作，以便在系统崩溃时重做未提交的事务；
  - 持久性日志，确保已提交的事务不会丢失；

为了保证数据能正确的`持久化`，在系统出现异常的时候通常会对redo log进行回放，把已经commit的事务进行数据重做。


      Redo Log记录的是新数据的备份。在事务提交前，只要将Redo Log持久化即可，不需要将数据持久化。当系统崩溃时，虽然数据没有持久化，但是Redo Log已经持久化。系统可以根据Redo Log的内容，将所有数据恢复到最新的状态。

## Undo log （回滚日志）

- **用途**
  - 事务回滚：用于支持事务的原子性，在事务回滚时撤销已完成的修改；
  - 一致性读：支持MVCC，实现快照读，从而提供一致性视图；
- **特性**
  - 记录在事务进行过程中，对数据所做的每一个修改的原始值；
  - 在需要回滚时，使用这些日志将数据恢复到修改前的状态；

1. 保证事务进行rollback时的原子性，当事务进行回滚或者系统异常需要对数据进行回滚的的时候可以用undo log的日志进行数据重做。

2.  用于`MVCC快照读`的数据，在MVCC多版本控制中，通过读取undo log的历史版本数据可以实现不同事务版本号都拥有自己独立的快照数据版本。


      Undo Log的原理很简单，为了满足事务的原子性，在操作任何数据之前，首先将数据备份到一个地方（这个存储数据备份的地方称为Undo Log）。然后进行数据的修改。如果出现了错误或者用户执行了ROLLBACK语句，系统可以利用Undo Log中的备份将数据恢复到事务开始之前的状态。
      除了可以保证事务的原子性，Undo Log也可以用来辅助完成事务的持久化。

## redo log 和undo log 的生成过程

        事务操作：将user表进行 update user set name = '顾彻' where id=1 

整体流程如下：
1. 在修改数据前，把需要修改的数据load到内存中；
2. 将原数据写入到undo log中；
3. 将修改后的数据写入到redo log中；
4. 当commit / rollback 时，将redo log  / undo log 中的数据修改到表中；

事务持久性的保障：
持久化性是在系统出现异常、崩溃时依然能保证我们的数据能正常持久化到数据库中，在系统出现异常或崩溃时，
我们会对redo log进行回放，对于已经commit的事务进行数据重做，对于事务没有commit的事务，我们可以通过
undo log来对事务涉及到的数据回滚从而保证事务数据的正确性；