# 规则引擎设计方案

## 背景

> ​       当前有很多系统需要执行一些规则，但是他们都是将这些规则写在代码里，每次规则调整后，都需要通过需求版本，修改代码才能上线，修改代码可能带来一些问题：比如：导致其他业务功能受到影响；

## 设计方案

设计方案



流程图如下：

![规则流程图 (4)](/Users/chengen.gu/Downloads/规则流程图 (4).png)

## 接口设计

### 接口请求方式

- https
- ESA

### 



## 表设计

- 规则表(open_rule_info)

| 名称      | 编码         | 默认值 | 是否可为空 | 备注                      |
| --------- | ------------ | ------ | ---------- | ------------------------- |
| 主键ID    | ID           |        | 否         | 表主键                    |
| 规则ID    | rule_id      |        | 否         | 规则ID                    |
| 规则名称  | rule_name    |        | Y          | 规则名称                  |
| 规则脚本  | script       |        |            | 规则详情(groovy脚本)      |
| 状态      | status       |        |            | 1：初始化，2：发布        |
| 是否有效  | is_valid     |        |            | 0：否；1：是              |
| 规则描述  | rule_desc    |        |            | 对规则脚本的一个描述      |
| 渠道      | channel      |        |            | 接入方渠道                |
| 开始时间  | start_time   |        |            | 规则开始时间              |
| 结束时间  | end_time     |        |            | 规则结束时间              |
| 创建时间  | date_created |        |            | 规则创建时间              |
| 更新时间  | date_updated |        |            | 规则更新时间              |
| 创建人    | create_by    |        |            | 规则创建人                |
| 更新人    | update_by    |        |            | 规则更新人                |
| 扩展字段1 | entend1      |        | Y          | 规则参数，使用 " \| "隔开 |

- 规则字段关系配置表(clms_open_rule_field_rela_config)

| 名称         | 编码                   | 默认值 | 是否可为空 | 备注                  |
| ------------ | ---------------------- | ------ | ---------- | --------------------- |
| 主键         | ID                     |        | N          | 主键ID                |
| 字段ID       | field_id               |        |            | 属性ID                |
| 字段类型     | field_type             |        |            | 属性类型              |
| 字段关系符   | comparator             |        |            | 字段比较符 > < = >=等 |
| 字段值       | field_value            |        |            | 属性值                |
| 字段等级     | field_level            |        |            | 属性等级              |
| 字段组       | field_group            |        |            | 属性组                |
| 字段组操作符 | field_group_comparator |        |            | 字段组操作符          |
| 规则ID       | rule_id                |        |            | 规则所属ID            |

- 规则参数信息表(clms_open_rule_param_info)

| 名称     | 编码       | 默认值 | 是否可为空 | 备注     |
| -------- | ---------- | ------ | ---------- | -------- |
| 主键     | ID         |        | N          | 主键ID   |
| 字段名称 | field_name |        |            | 字段名   |
| 字段描述 | field_desc |        |            | 字段描述 |
| 字段类型 | field_type |        |            | 字段类   |